<html>
  <head>
    <title>Arduino Serial display</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script type="text/javascript">
      "use strict";
      var url = "/voltage";
      var voltage = 0;
      var lastFive = [0, 0, 0, 0, 0];
      var canvas;
      var chart;

      function ready(){
        canvas = document.getElementById("graph").getContext("2d");
        chart = new Chart(canvas, {
          type: 'line',
          data: {
            labels: [-4, -3, -2, -1, 0],
            datasets: [{
              data: lastFive,
              label: "voltage",
              lineTension: 0
            }]
          },
          options: {
            scales: {
              yAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: "Voltage (V)"
                },
                ticks: {
                  beginAtZero: true
                }
              }],
              xAxes: [{
                ticks: {
                  beginAtZero: true
                },
                scaleLabel: {
                  display: true,
                  labelString: "Time since recording (s)"
                }
              }]
            },
            animation: {
              duration: 0
            }
          }
        });
      }

      function updateBody(){
        for (let i = 0; i < 5; i++){
          document.getElementById("v"+String(4-i)).innerHTML = lastFive[i];
        }
        chart.update();
      }

      setInterval(function(){
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function(){
          if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
            lastFive.push(xmlHttp.responseText);
            lastFive.splice(0, 1);
            updateBody();
            //let str = lastFive.join(" ");
            //document.getElementById("voltage").innerHTML = str;
          }
        };

        xmlHttp.open("GET", url, true);
        xmlHttp.send(null);
      }, 1000);
    </script>
  </head>
  <body onload="ready()">
    <h1>Voltage over time</h1>
    <table>
      <tr><td>4 seconds ago</td><td id="v4"></td></tr>
      <tr><tr><td>3 seconds ago</td><td id="v3"></td></tr>
      <tr><td>2 seconds ago</td><td id="v2"></td></tr>
      <tr><td>1 second ago</td><td id="v1"></td></tr>
      <tr><td>Just now</td><td id="v0"></td></tr>
    </table>
    <canvas id="graph" width="500" height="200"></canvas>
  </body>
</html>
